<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π - HPG Community</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì∏</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 4px;
        }

        .profile-meta {
            font-size: 14px;
            color: #666;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a9d9d 0%, #2d7a7a 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 157, 157, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .gallery-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .gallery-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .gallery-header h2 {
            font-size: 20px;
            color: #333;
        }

        .photo-count {
            font-size: 14px;
            color: #999;
            font-weight: normal;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .gallery-item-info {
            padding: 12px;
            background: white;
        }

        .gallery-item-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 6px;
        }

        .gallery-item-description {
            font-size: 14px;
            color: #333;
            line-height: 1.4;
        }

        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .lightbox.active {
            display: flex;
        }
        
        .lightbox-image-container {
            width: 100%;
            height: 100%;
            overflow: visible;
            cursor: grab;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lightbox-image-container.dragging {
            cursor: grabbing;
        }

        .lightbox-image {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            transition: transform 0.2s ease;
            user-select: none;
            -webkit-user-drag: none;
            transform-origin: center center;
        }
        
        .lightbox-controls {
            position: absolute;
            top: 70px;
            left: 20px;
            z-index: 1001;
            display: flex;
            gap: 5px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .add-photo-form {
            background: #f8f9ff;
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            display: none;
        }

        .add-photo-form.active {
            display: block;
        }

        .add-photo-form h3 {
            margin: 0 0 20px 0;
            color: #667eea;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-hint {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }

        .gallery-item-delete {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .gallery-item:hover .gallery-item-delete {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <span style="font-size: 32px;">üì∏</span>
                <div>
                    <div class="profile-name" id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div class="profile-meta" id="profileMeta"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button id="backToListBtn" class="btn btn-secondary" onclick="window.location.href='gallery.html'" style="display: none;">
                    ‚Üê –ö —Å–ø–∏—Å–∫—É –ø—Ä–æ—Ñ–∏–ª–µ–π
                </button>
                <a href="index.html" class="btn btn-secondary">‚Üê –í –∫–∞—Ç–∞–ª–æ–≥</a>
            </div>
        </div>

        <div class="gallery-container">
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞) -->
            <div id="addPhotoForm" class="add-photo-form">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px 12px 0 0; margin: -20px -20px 20px -20px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 22px; font-weight: 600;">üì∏ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 14px; line-height: 1.6;">
                        –†–∞–∑–º–µ—â–∞–π—Ç–µ —Ñ–æ—Ç–æ –Ω–∞ –ª—é–±–æ–º —Å–µ—Ä–≤–∏—Å–µ –∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Å—Å—ã–ª–∫–∏ –≤ –≥–∞–ª–µ—Ä–µ—é.<br>
                        <strong>–í–∞–∂–Ω–æ:</strong> –ú—ã —Ö—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏, —Ñ–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è —É –≤–∞—Å –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ.
                    </p>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∏ -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; overflow-x: auto;">
                    <button id="tabSingle" class="btn" onclick="switchTab('single')" 
                            style="border: none; border-bottom: 3px solid #667eea; background: transparent; color: #667eea; font-weight: 600; padding: 10px 20px; border-radius: 0; white-space: nowrap;">
                        –û–¥–Ω–æ —Ñ–æ—Ç–æ
                    </button>
                    <button id="tabBulk" class="btn" onclick="switchTab('bulk')" 
                            style="border: none; border-bottom: 3px solid transparent; background: transparent; color: #999; font-weight: 500; padding: 10px 20px; border-radius: 0; white-space: nowrap;">
                        –ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç
                    </button>
                </div>

                <!-- –§–æ—Ä–º–∞ –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ç–æ -->
                <div id="singlePhotoForm">
                    <div style="background: #f5f5f5; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <div style="font-weight: 600; color: #333; margin-bottom: 15px; font-size: 15px;">üì∏ –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ñ–æ—Ç–æ:</div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                            <!-- Google Photos -->
                            <div style="text-align: center;">
                                <a href="https://photos.google.com" target="_blank" style="display: block; padding: 12px; background: #4285f4; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üì∑ Google Photos
                                </a>
                                <button onclick="showHelp('google')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                            
                            <!-- Imgur -->
                            <div style="text-align: center;">
                                <a href="https://imgur.com/upload" target="_blank" style="display: block; padding: 12px; background: #1bb76e; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üñºÔ∏è Imgur
                                </a>
                                <button onclick="showHelp('imgur')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                            
                            <!-- ImgBB -->
                            <div style="text-align: center;">
                                <a href="https://imgbb.com/" target="_blank" style="display: block; padding: 12px; background: #3b7dd6; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üåÑ ImgBB
                                </a>
                                <button onclick="showHelp('imgbb')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                            
                            <!-- PostImages -->
                            <div style="text-align: center;">
                                <a href="https://postimages.org/" target="_blank" style="display: block; padding: 12px; background: #ff6b35; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üé® PostImages
                                </a>
                                <button onclick="showHelp('postimg')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="font-size: 15px; font-weight: 600; color: #333;">üîó –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ *</label>
                        <input type="url" id="photoUrl" placeholder="https://i.imgur.com/... –∏–ª–∏ https://lh3.googleusercontent.com/...">
                        <div style="margin-top: 8px; padding: 10px; background: #e8f4fd; border-left: 3px solid #2196f3; border-radius: 4px; font-size: 13px; color: #1565c0;">
                            üí° <strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ .jpg, .png –∏–ª–∏ .webp –∏ –≤–µ—Å—Ç–∏ –ø—Ä—è–º–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∞ –Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Å—ä—ë–º–∫–∏</label>
                        <input type="date" id="photoDate">
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ (—Å—Ç–∞–¥–∏—è —Ä–æ—Å—Ç–∞, –Ω–∞–±–ª—é–¥–µ–Ω–∏—è)</label>
                        <textarea id="photoDescription" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 3 –Ω–µ–¥–µ–ª–∏ –æ—Ç –ø–æ—Å–∞–¥–∫–∏, –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–æ—Å—Ç..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="addPhoto()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
                        <button class="btn btn-secondary" onclick="toggleAddForm()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ -->
                <div id="bulkPhotoForm" style="display: none;">
                    <div style="background: #f5f5f5; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <div style="font-weight: 600; color: #333; margin-bottom: 15px; font-size: 15px;">üì∏ –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ñ–æ—Ç–æ:</div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                            <!-- Google Photos -->
                            <div style="text-align: center;">
                                <a href="https://photos.google.com" target="_blank" style="display: block; padding: 12px; background: #4285f4; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üì∑ Google Photos
                                </a>
                                <button onclick="showHelp('google')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                            
                            <!-- Imgur -->
                            <div style="text-align: center;">
                                <a href="https://imgur.com/upload" target="_blank" style="display: block; padding: 12px; background: #1bb76e; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üñºÔ∏è Imgur
                                </a>
                                <button onclick="showHelp('imgur')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                            
                            <!-- ImgBB -->
                            <div style="text-align: center;">
                                <a href="https://imgbb.com/" target="_blank" style="display: block; padding: 12px; background: #3b7dd6; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üåÑ ImgBB
                                </a>
                                <button onclick="showHelp('imgbb')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                            
                            <!-- PostImages -->
                            <div style="text-align: center;">
                                <a href="https://postimages.org/" target="_blank" style="display: block; padding: 12px; background: #ff6b35; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 13px;">
                                    üé® PostImages
                                </a>
                                <button onclick="showHelp('postimg')" style="margin-top: 5px; border: none; background: transparent; color: #666; cursor: pointer; font-size: 18px;" title="–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å">‚ùì</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="font-size: 15px; font-weight: 600; color: #333;">üîó –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É) *</label>
                        <textarea id="bulkUrls" rows="8" placeholder="https://i.imgur.com/abc123.jpg&#10;https://lh3.googleusercontent.com/xyz789.png&#10;https://i.ibb.co/def456.webp"></textarea>
                        <div style="margin-top: 8px; padding: 10px; background: #fff3e0; border-left: 3px solid #ff9800; border-radius: 4px; font-size: 13px; color: #e65100;">
                            ‚ö° <strong>–°–æ–≤–µ—Ç:</strong> –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ñ–æ—Ç–æ —Å—Ä–∞–∑—É –Ω–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å, —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <textarea id="bulkDescription" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–æ—Å—Ç–∞ –∑–∞ –º–∞—Ä—Ç 2025"></textarea>
                        <div class="form-hint">–≠—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ –≤—Å–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º</div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="addPhotoBulk()">‚ûï –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</button>
                        <button class="btn btn-secondary" onclick="toggleAddForm()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>

            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞) -->
            <button id="showAddFormBtn" class="btn btn-primary" style="display: none; margin-bottom: 20px;" onclick="toggleAddForm()">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
            </button>

            <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #e0e0e0;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2 style="margin: 0 0 5px 0; font-size: 24px; font-weight: 600; color: #333;">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h2>
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            <span class="photo-count" id="photoCount"></span>
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div style="display: inline-block; padding: 8px 16px; background: #f5f5f5; border-radius: 6px; font-size: 12px; color: #666;">
                            ‚ÑπÔ∏è –§–æ—Ç–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
                        </div>
                    </div>
                </div>
            </div>
            <div id="galleryGrid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>

    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <button class="lightbox-close">‚úï</button>
        <div class="lightbox-controls">
            <button onclick="event.stopPropagation(); zoomIn()" title="–£–≤–µ–ª–∏—á–∏—Ç—å (–∫–æ–ª—ë—Å–∏–∫–æ –≤–≤–µ—Ä—Ö)" style="background: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-size: 18px; margin-right: 5px;">üîç+</button>
            <button onclick="event.stopPropagation(); zoomOut()" title="–£–º–µ–Ω—å—à–∏—Ç—å (–∫–æ–ª—ë—Å–∏–∫–æ –≤–Ω–∏–∑)" style="background: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-size: 18px; margin-right: 5px;">üîç‚àí</button>
            <button onclick="event.stopPropagation(); resetZoom()" title="–°–±—Ä–æ—Å–∏—Ç—å (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫)" style="background: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-size: 16px; margin-right: 5px;">‚Ü∫</button>
            <button onclick="event.stopPropagation(); toggleFullscreen()" title="–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω (F11)" style="background: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-size: 16px;">‚õ∂</button>
        </div>
        <div class="lightbox-image-container" id="lightboxContainer" onclick="event.stopPropagation()">
            <img class="lightbox-image" id="lightboxImage" src="" alt="" ondblclick="resetZoom()">
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ -->
    <div id="helpModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;" onclick="closeHelp()">
        <div style="background: white; border-radius: 12px; max-width: 500px; width: 90%; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); position: relative;" onclick="event.stopPropagation()">
            <button onclick="closeHelp()" style="position: absolute; top: 15px; right: 15px; border: none; background: transparent; font-size: 24px; cursor: pointer; color: #999; line-height: 1;">‚úï</button>
            <div id="helpContent"></div>
        </div>
    </div>

    <!-- –ö–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è alert/confirm -->
    <div id="customModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 20000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; max-width: 450px; width: 90%; padding: 0; box-shadow: 0 8px 32px rgba(0,0,0,0.4); overflow: hidden;" onclick="event.stopPropagation()">
            <div id="customModalHeader" style="padding: 20px 25px; border-bottom: 1px solid #e0e0e0; background: #f8f9fa;">
                <h3 id="customModalTitle" style="margin: 0; font-size: 18px; font-weight: 600; color: #333;"></h3>
            </div>
            <div id="customModalBody" style="padding: 25px; font-size: 15px; line-height: 1.6; color: #555; white-space: pre-wrap;"></div>
            <div id="customModalFooter" style="padding: 15px 25px; border-top: 1px solid #e0e0e0; display: flex; gap: 10px; justify-content: flex-end; background: #f8f9fa;"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAR5qXMGP8Erapla69wJ7cUbbF4MNlbkcY",
            authDomain: "wega-hpg.firebaseapp.com",
            projectId: "wega-hpg",
            storageBucket: "wega-hpg.firebasestorage.app",
            messagingSenderId: "652081809935",
            appId: "1:652081809935:web:84a407f1a6bfc719aa717a"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let profileData = null;
        let photos = [];

        const urlParams = new URLSearchParams(window.location.search);
        const profileId = urlParams.get('profile');

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        auth.onAuthStateChanged(user => {
            currentUser = user;
            
            if (!currentUser) {
                showAuthRequired();
            } else if (!profileId) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                loadUserProfiles();
            } else {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≥–∞–ª–µ—Ä–µ—é
                loadGallery();
            }
        });

        function showAuthRequired() {
            document.getElementById('galleryGrid').innerHTML = `
                <div class="empty-state">
                    <div style="font-size: 64px; margin-bottom: 20px;">üîí</div>
                    <h3>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
                    <p>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –≥–∞–ª–µ—Ä–µ—è–º–∏ —Å–≤–æ–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π</p>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="window.location.href='index.html'">
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                    </button>
                </div>
            `;
        }

        async function loadUserProfiles() {
            document.getElementById('profileName').textContent = '–ú–æ–∏ –ø—Ä–æ—Ñ–∏–ª–∏';
            document.getElementById('profileMeta').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–∞–ª–µ—Ä–µ–µ–π';

            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (—á—Ç–æ–±—ã –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å)
                const snapshot = await db.collection('profiles')
                    .where('userId', '==', currentUser.uid)
                    .get();

                if (snapshot.empty) {
                    document.getElementById('galleryGrid').innerHTML = `
                        <div class="empty-state">
                            <div style="font-size: 64px; margin-bottom: 20px;">üìù</div>
                            <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª–µ–π</h3>
                            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –∫ –Ω–µ–º—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="window.location.href='index.html'">
                                –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                            </button>
                        </div>
                    `;
                    return;
                }

                // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
                const profiles = [];
                snapshot.forEach(doc => {
                    profiles.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
                profiles.sort((a, b) => {
                    const timeA = a.modified?.toMillis() || 0;
                    const timeB = b.modified?.toMillis() || 0;
                    return timeB - timeA;
                });

                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">';
                
                profiles.forEach(profile => {
                    const galleryCount = (profile.gallery && profile.gallery.length) || 0;
                    const date = profile.modified?.toDate().toLocaleDateString('ru-RU') || '';
                    
                    html += `
                        <div onclick="window.location.href='gallery.html?profile=${profile.id}'" 
                             style="background: white; border-radius: 12px; padding: 20px; cursor: pointer; 
                                    transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                                    border: 2px solid transparent;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="font-size: 32px;">üå±</div>
                                <div style="flex: 1; min-width: 0;">
                                    <div style="font-weight: 600; font-size: 16px; color: #333; 
                                                overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        ${escapeHtml(profile.name)}
                                    </div>
                                    <div style="font-size: 12px; color: #999; margin-top: 4px;">
                                        –ò–∑–º–µ–Ω–µ–Ω–æ: ${date}
                                    </div>
                                </div>
                            </div>
                            ${profile.description ? `
                                <div style="color: #666; font-size: 14px; line-height: 1.4; 
                                            margin-bottom: 12px; overflow: hidden; 
                                            text-overflow: ellipsis; display: -webkit-box;
                                            -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                    ${escapeHtml(profile.description)}
                                </div>
                            ` : ''}
                            <div style="display: flex; gap: 15px; padding-top: 12px; 
                                        border-top: 1px solid #f0f0f0; font-size: 13px; color: #666;">
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span>üì∏</span>
                                    <strong>${galleryCount}</strong> —Ñ–æ—Ç–æ
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span>üëÅÔ∏è</span>
                                    ${profile.views || 0}
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span>üí¨</span>
                                    ${profile.commentsCount || 0}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                document.getElementById('galleryGrid').innerHTML = html;

                // –î–æ–±–∞–≤–ª—è–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç —á–µ—Ä–µ–∑ CSS
                const style = document.createElement('style');
                style.textContent = `
                    .gallery-container > div > div:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
                        border-color: #667eea !important;
                    }
                `;
                document.head.appendChild(style);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π:', error);
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏');
            }
        }

        async function loadGallery() {
            try {
                const doc = await db.collection('profiles').doc(profileId).get();
                
                if (!doc.exists) {
                    showError('–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }

                profileData = doc.data();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
                if (currentUser.uid !== profileData.userId) {
                    document.getElementById('galleryGrid').innerHTML = `
                        <div class="empty-state">
                            <div style="font-size: 64px; margin-bottom: 20px;">üîí</div>
                            <h3>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h3>
                            <p>–í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –≥–∞–ª–µ—Ä–µ—è–º–∏ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="window.location.href='gallery.html'">
                                –ö —Å–ø–∏—Å–∫—É –º–æ–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
                            </button>
                        </div>
                    `;
                    return;
                }

                document.getElementById('profileName').textContent = profileData.name;
                document.getElementById('profileMeta').textContent = `–ê–≤—Ç–æ—Ä: ${profileData.userName || '–ê–Ω–æ–Ω–∏–º'}`;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                document.getElementById('showAddFormBtn').style.display = 'inline-flex';
                document.getElementById('backToListBtn').style.display = 'inline-flex';

                photos = profileData.gallery || [];
                renderGallery();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏');
            }
        }

        function renderGallery() {
            document.getElementById('photoCount').textContent = `(${photos.length})`;

            if (photos.length === 0) {
                const isOwner = currentUser && profileData && currentUser.uid === profileData.userId;
                document.getElementById('galleryGrid').innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 64px; margin-bottom: 20px;">üì∏</div>
                        <h3>–ì–∞–ª–µ—Ä–µ—è –ø—É—Å—Ç–∞</h3>
                        <p style="color: #666; margin-bottom: 20px;">
                            ${isOwner ? '–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, —Ä–∞–∑–º–µ—Å—Ç–∏–≤ –∏—Ö –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π' : '–ê–≤—Ç–æ—Ä –ø—Ä–æ—Ñ–∏–ª—è –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–∏–ª —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏'}
                        </p>
                        ${isOwner ? `
                            <div style="max-width: 400px; margin: 0 auto; padding: 20px; background: #f5f5f5; border-radius: 8px; text-align: left;">
                                <div style="font-weight: 600; margin-bottom: 10px; color: #333;">üìå –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</div>
                                <ol style="margin: 0; padding-left: 20px; color: #666; font-size: 14px; line-height: 1.8;">
                                    <li>–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–æ—Ç–æ –Ω–∞ –ª—é–±–æ–º —Å–µ—Ä–≤–∏—Å–µ</li>
                                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É</li>
                                    <li>–î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ –≥–∞–ª–µ—Ä–µ—é</li>
                                </ol>
                                <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px; font-size: 12px; color: #999;">
                                    üí° –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ, –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            const sortedPhotos = [...photos].sort((a, b) => {
                const dateA = a.date ? new Date(a.date) : new Date(0);
                const dateB = b.date ? new Date(b.date) : new Date(0);
                return dateB - dateA;
            });

            let html = '<div class="gallery-grid">';
            sortedPhotos.forEach((photo) => {
                const index = photos.indexOf(photo);
                const date = photo.date ? new Date(photo.date).toLocaleDateString('ru-RU') : '–ë–µ–∑ –¥–∞—Ç—ã';
                const isOwner = currentUser && profileData && currentUser.uid === profileData.userId;
                
                html += `
                    <div class="gallery-item" onclick="openLightbox('${escapeJs(photo.url)}')">
                        <img src="${photo.url}" alt="${escapeHtml(photo.description || '')}" 
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'250\\' height=\\'250\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'250\\' height=\\'250\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23999\\' font-size=\\'14\\'%3E–§–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ%3C/text%3E%3C/svg%3E'">
                        ${isOwner ? `<button class="gallery-item-delete" onclick="event.stopPropagation(); deletePhoto(${index})">üóëÔ∏è</button>` : ''}
                        <div class="gallery-item-info">
                            <div class="gallery-item-date">üìÖ ${date}</div>
                            <div class="gallery-item-description">${escapeHtml(photo.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è')}</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('galleryGrid').innerHTML = html;
        }

        function switchTab(tab) {
            const tabs = {
                single: document.getElementById('tabSingle'),
                bulk: document.getElementById('tabBulk')
            };
            const forms = {
                single: document.getElementById('singlePhotoForm'),
                bulk: document.getElementById('bulkPhotoForm')
            };

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            Object.values(tabs).forEach(t => {
                t.style.borderBottomColor = 'transparent';
                t.style.color = '#999';
                t.style.fontWeight = '500';
            });
            Object.values(forms).forEach(f => f.style.display = 'none');

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            tabs[tab].style.borderBottomColor = '#667eea';
            tabs[tab].style.color = '#667eea';
            tabs[tab].style.fontWeight = '600';
            forms[tab].style.display = 'block';
        }

        function toggleAddForm() {
            const form = document.getElementById('addPhotoForm');
            const btn = document.getElementById('showAddFormBtn');
            
            if (form.classList.contains('active')) {
                form.classList.remove('active');
                btn.style.display = 'inline-flex';
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—ã
                document.getElementById('photoUrl').value = '';
                document.getElementById('photoDate').value = '';
                document.getElementById('photoDescription').value = '';
                document.getElementById('bulkUrls').value = '';
                document.getElementById('bulkDescription').value = '';
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
                switchTab('single');
            } else {
                form.classList.add('active');
                btn.style.display = 'none';
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
                document.getElementById('photoDate').valueAsDate = new Date();
            }
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ Google Photos –≤ –ø—Ä—è–º—É—é
        async function convertGooglePhotosUrl(url) {
            // –ï—Å–ª–∏ —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ photos.app.goo.gl –∏–ª–∏ photos.google.com/share
            if (url.includes('photos.app.goo.gl') || url.includes('photos.google.com/share')) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                const instruction = `
–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —Å—Å—ã–ª–∫–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –µ—ë –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
3. –ù–∞–∂–º–∏—Ç–µ –ü–†–ê–í–£–Æ –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
4. –í—ã–±–µ—Ä–∏—Ç–µ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
5. –í—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É —Å—é–¥–∞

–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –û–ö, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.
                `.trim();
                
                if (await customConfirm(instruction, '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è')) {
                    window.open(url, '_blank');
                }
                
                throw new Error('–í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å https://lh3.googleusercontent.com)');
            }
            return url;
        }

        async function addPhoto() {
            if (!currentUser || !profileData || currentUser.uid !== profileData.userId) {
                await customAlert('–¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ñ–∏–ª—è –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
                return;
            }

            let url = document.getElementById('photoUrl').value.trim();
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É –≤ –ø—Ä—è–º—É—é
            try {
                url = await convertGooglePhotosUrl(url);
            } catch (error) {
                await customAlert(error.message, '–û—à–∏–±–∫–∞');
                return;
            }
            const date = document.getElementById('photoDate').value;
            const description = document.getElementById('photoDescription').value.trim();

            if (!url) {
                await customAlert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é');
                return;
            }

            try {
                const newPhoto = {
                    url: url,
                    date: date || new Date().toISOString().split('T')[0],
                    description: description || '',
                    addedAt: new Date().toISOString(),
                    addedBy: currentUser.uid
                };

                photos.push(newPhoto);

                await db.collection('profiles').doc(profileId).update({
                    gallery: photos,
                    modified: firebase.firestore.FieldValue.serverTimestamp()
                });

                renderGallery();
                toggleAddForm();
                showNotification('‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                await customAlert('‚ùå –û—à–∏–±–∫–∞: ' + error.message, '–û—à–∏–±–∫–∞');
            }
        }

        async function addPhotoBulk() {
            if (!currentUser || !profileData || currentUser.uid !== profileData.userId) {
                await customAlert('–¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ñ–∏–ª—è –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
                return;
            }

            const urlsText = document.getElementById('bulkUrls').value.trim();
            const bulkDescription = document.getElementById('bulkDescription').value.trim();

            if (!urlsText) {
                await customAlert('–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å—Å—ã–ª–∫—É');
                return;
            }

            let urls = urlsText.split('\n').map(u => u.trim()).filter(u => u);
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –≤ –ø—Ä—è–º—ã–µ
            try {
                showNotification('‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–æ–∫...');
                const convertedUrls = [];
                for (const url of urls) {
                    const converted = await convertGooglePhotosUrl(url);
                    convertedUrls.push(converted);
                }
                urls = convertedUrls;
            } catch (error) {
                await customAlert(error.message, '–û—à–∏–±–∫–∞');
                return;
            }

            try {
                const today = new Date().toISOString().split('T')[0];
                const newPhotos = urls.map(url => ({
                    url: url,
                    date: today,
                    description: bulkDescription || '',
                    addedAt: new Date().toISOString(),
                    addedBy: currentUser.uid
                }));

                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–æ—Ç–æ
                photos.push(...newPhotos);

                await db.collection('profiles').doc(profileId).update({
                    gallery: photos,
                    modified: firebase.firestore.FieldValue.serverTimestamp()
                });

                renderGallery();
                toggleAddForm();
                showNotification(`‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${newPhotos.length} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π!`);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                await customAlert('‚ùå –û—à–∏–±–∫–∞: ' + error.message, '–û—à–∏–±–∫–∞');
            }
        }

        async function deletePhoto(index) {
            if (!currentUser || !profileData || currentUser.uid !== profileData.userId) {
                await customAlert('–¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ—Ñ–∏–ª—è –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
                return;
            }

            if (!await customConfirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é?')) {
                return;
            }

            try {
                photos.splice(index, 1);

                await db.collection('profiles').doc(profileId).update({
                    gallery: photos,
                    modified: firebase.firestore.FieldValue.serverTimestamp()
                });

                renderGallery();
                showNotification('‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                await customAlert('‚ùå –û—à–∏–±–∫–∞: ' + error.message, '–û—à–∏–±–∫–∞');
            }
        }

        let currentZoom = 1;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let startX = 0;
        let startY = 0;

        function openLightbox(url) {
            const img = document.getElementById('lightboxImage');
            img.src = url;
            document.getElementById('lightbox').classList.add('active');
            resetZoom();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∑—É–º–∞ –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            const container = document.getElementById('lightboxContainer');
            
            // –ó—É–º –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
            container.addEventListener('wheel', handleWheel, { passive: false });
            
            // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
            container.addEventListener('mousedown', startDrag);
            container.addEventListener('mousemove', drag);
            container.addEventListener('mouseup', endDrag);
            container.addEventListener('mouseleave', endDrag);
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            
            // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            const container = document.getElementById('lightboxContainer');
            container.removeEventListener('wheel', handleWheel);
            container.removeEventListener('mousedown', startDrag);
            container.removeEventListener('mousemove', drag);
            container.removeEventListener('mouseup', endDrag);
            container.removeEventListener('mouseleave', endDrag);
        }

        function handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -0.1 : 0.1;
            currentZoom = Math.min(Math.max(1, currentZoom + delta), 5);
            applyZoom();
        }

        function zoomIn() {
            currentZoom = Math.min(5, currentZoom + 0.2);
            applyZoom();
        }

        function zoomOut() {
            currentZoom = Math.max(1, currentZoom - 0.2);
            if (currentZoom === 1) {
                currentX = 0;
                currentY = 0;
            }
            applyZoom();
        }

        function resetZoom() {
            currentZoom = 1;
            currentX = 0;
            currentY = 0;
            applyZoom();
        }

        function applyZoom() {
            const img = document.getElementById('lightboxImage');
            img.style.transform = `scale(${currentZoom}) translate(${currentX}px, ${currentY}px)`;
        }

        function startDrag(e) {
            if (currentZoom <= 1) return;
            isDragging = true;
            startX = e.clientX - currentX;
            startY = e.clientY - currentY;
            document.getElementById('lightboxContainer').classList.add('dragging');
        }

        function drag(e) {
            if (!isDragging || currentZoom <= 1) return;
            e.preventDefault();
            currentX = e.clientX - startX;
            currentY = e.clientY - startY;
            applyZoom();
        }

        function endDrag() {
            isDragging = false;
            document.getElementById('lightboxContainer').classList.remove('dragging');
        }

        // –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
        function toggleFullscreen() {
            const lightbox = document.getElementById('lightbox');
            
            if (!document.fullscreenElement) {
                // –í—Ö–æ–¥ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                if (lightbox.requestFullscreen) {
                    lightbox.requestFullscreen();
                } else if (lightbox.webkitRequestFullscreen) {
                    lightbox.webkitRequestFullscreen();
                } else if (lightbox.msRequestFullscreen) {
                    lightbox.msRequestFullscreen();
                }
            } else {
                // –í—ã—Ö–æ–¥ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è ESC –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –ª–∞–π—Ç–±–æ–∫—Å–∞
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('lightbox').classList.contains('active')) {
                if (!document.fullscreenElement) {
                    closeLightbox();
                }
            }
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞
        function showHelp(service) {
            const instructions = {
                google: {
                    title: 'üì∑ Google Photos',
                    steps: [
                        '–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://photos.google.com" target="_blank">Google Photos</a> –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ',
                        '–ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω–æ–µ —Ñ–æ—Ç–æ –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –Ω–µ–º—É',
                        '–ù–∞–∂–º–∏—Ç–µ <strong>–ø—Ä–∞–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏</strong> –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é',
                        '–í—ã–±–µ—Ä–∏—Ç–µ <strong>"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"</strong>',
                        '–í–µ—Ä–Ω–∏—Ç–µ—Å—å —Å—é–¥–∞ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ —Ñ–æ—Ä–º—É'
                    ]
                },
                imgur: {
                    title: 'üñºÔ∏è Imgur',
                    steps: [
                        '–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://imgur.com/upload" target="_blank">Imgur</a> –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ',
                        '<strong>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ</strong> —Ñ–æ—Ç–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "Browse"',
                        '–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ',
                        '–ù–∞–∂–º–∏—Ç–µ <strong>–ø—Ä–∞–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏</strong> –ø–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º—É —Ñ–æ—Ç–æ',
                        '–í—ã–±–µ—Ä–∏—Ç–µ <strong>"Copy image address"</strong>',
                        '–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ —Ñ–æ—Ä–º—É'
                    ]
                },
                imgbb: {
                    title: 'üåÑ ImgBB',
                    steps: [
                        '–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://imgbb.com/" target="_blank">ImgBB</a> –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ',
                        '–ù–∞–∂–º–∏—Ç–µ <strong>"Start uploading"</strong> –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ',
                        '–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏',
                        '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É <strong>"Direct link"</strong>',
                        '–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ—è–≤–∏–≤—à—É—é—Å—è —Å—Å—ã–ª–∫—É',
                        '–í—Å—Ç–∞–≤—å—Ç–µ –µ—ë –≤ —Ñ–æ—Ä–º—É'
                    ]
                },
                postimg: {
                    title: 'üé® PostImages',
                    steps: [
                        '–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://postimages.org/" target="_blank">PostImages</a> –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ',
                        '–ù–∞–∂–º–∏—Ç–µ <strong>"Choose images"</strong> –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ',
                        '–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏',
                        '–ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ <strong>"Direct link"</strong>',
                        '–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ —ç—Ç–æ–≥–æ –ø–æ–ª—è',
                        '–í—Å—Ç–∞–≤—å—Ç–µ –µ—ë –≤ —Ñ–æ—Ä–º—É'
                    ]
                }
            };

            const content = instructions[service];
            const stepsHtml = content.steps.map((step, i) => `
                <li style="margin-bottom: 10px; line-height: 1.6;">${step}</li>
            `).join('');

            document.getElementById('helpContent').innerHTML = `
                <h3 style="margin: 0 0 20px 0; color: #333; font-size: 20px;">${content.title}</h3>
                <ol style="margin: 0; padding-left: 20px; color: #555;">
                    ${stepsHtml}
                </ol>
                <div style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 6px; text-align: center;">
                    <button onclick="closeHelp()" class="btn btn-primary">–ü–æ–Ω—è—Ç–Ω–æ</button>
                </div>
            `;

            document.getElementById('helpModal').style.display = 'flex';
        }

        function closeHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –≤–º–µ—Å—Ç–æ alert/confirm
        function customAlert(message, title = '–í–Ω–∏–º–∞–Ω–∏–µ') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                document.getElementById('customModalTitle').textContent = title;
                document.getElementById('customModalBody').textContent = message;
                document.getElementById('customModalFooter').innerHTML = `
                    <button onclick="closeCustomModal(); customModalResolve(true);" class="btn btn-primary" style="min-width: 100px;">OK</button>
                `;
                modal.style.display = 'flex';
                
                window.customModalResolve = resolve;
            });
        }

        function customConfirm(message, title = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                document.getElementById('customModalTitle').textContent = title;
                document.getElementById('customModalBody').textContent = message;
                document.getElementById('customModalFooter').innerHTML = `
                    <button onclick="closeCustomModal(); customModalResolve(false);" class="btn btn-secondary" style="min-width: 100px;">–û—Ç–º–µ–Ω–∞</button>
                    <button onclick="closeCustomModal(); customModalResolve(true);" class="btn btn-primary" style="min-width: 100px;">OK</button>
                `;
                modal.style.display = 'flex';
                
                window.customModalResolve = resolve;
            });
        }

        function closeCustomModal() {
            document.getElementById('customModal').style.display = 'none';
        }

        function showError(msg) {
            document.getElementById('galleryGrid').innerHTML = `
                <div class="empty-state">
                    <div style="font-size: 64px;">‚ùå</div>
                    <h3>${escapeHtml(msg)}</h3>
                </div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeJs(text) {
            return text.replace(/'/g, "\\'").replace(/"/g, '\\"');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4caf50;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                font-size: 14px;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
